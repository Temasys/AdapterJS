/*! adapterjs - v0.0.2 - 2014-08-14 */
var Temasys=Temasys||{};if(Temasys.WebRTCPlugin=Temasys.WebRTCPlugin||{},Temasys.WebRTCPlugin.isPluginInstalled=null,Temasys.WebRTCPlugin.defineWebRTCInterface=null,Temasys.WebRTCPlugin.isDefined=null,Temasys.WebRTCPlugin.injectPlugin=null,Temasys.WebRTCPlugin.checkIfReady=null,Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb=null,Temasys.WebRTCPlugin.temPluginInfo={pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0"},Temasys.WebRTCPlugin.TemPageId=Math.random().toString(36).slice(2),Temasys.WebRTCPlugin.TemRTCPlugin=null,__TemWebRTCReady0=function(){arguments.callee.StaticWasInit=arguments.callee.StaticWasInit||1,1===arguments.callee.StaticWasInit&&(Temasys.isPluginReady=!0,Temasys.pluginReadyState=Temasys.PLUGIN_READY_STATE.READY),arguments.callee.StaticWasInit++},Temasys.PLUGIN_READY_STATE={INIT:0,READY:1},Temasys._ICECONNECTION_STATE={STARTING:"starting",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"connected",DONE:"completed",DISCONNECTED:"disconnected",FAILED:"failed",CLOSED:"closed"},Temasys.ICEConnectionFiredStates={},Temasys.pluginReadyState=Temasys.PLUGIN_READY_STATE.INIT,maybeFixConfiguration=function(pcConfig){if(null!==pcConfig)for(var i=0;i<pcConfig.iceServers.length;i++)pcConfig.iceServers[i].hasOwnProperty("urls")&&(pcConfig.iceServers[i].url=pcConfig.iceServers[i].urls,delete pcConfig.iceServers[i].urls)},getDetectedBrowser=function(){var hasMatch,agent={},checkMatch=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(navigator.mozGetUserMedia?agent.mozWebRTC=!0:navigator.webkitGetUserMedia?agent.webkitWebRTC=!0:navigator.userAgent.indexOf("Safari")&&("undefined"!=typeof InstallTrigger?agent.browser="Firefox":document.documentMode?agent.browser="IE":Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?agent.browser="Safari":window.opera||navigator.userAgent.indexOf(" OPR/")>=0?agent.browser="Opera":window.chrome&&(agent.browser="Chrome"),agent.pluginWebRTC=!0),/trident/i.test(checkMatch[1])?(hasMatch=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],agent.browser="IE",agent.version=parseInt(hasMatch[1]||"0",10)):"Chrome"===checkMatch[1]&&(hasMatch=navigator.userAgent.match(/\bOPR\/(\d+)/),null!==hasMatch&&(agent.browser="Opera",agent.version=parseInt(hasMatch[1],10))),agent.browser||(agent.browser=checkMatch[1]),!agent.version)try{checkMatch=checkMatch[2]?[checkMatch[1],checkMatch[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(hasMatch=navigator.userAgent.match(/version\/(\d+)/i))&&checkMatch.splice(1,1,hasMatch[1]),agent.version=parseInt(checkMatch[1],10)}catch(error){agent.version=0}return agent.os=navigator.platform,agent.isSCTPDCSupported=agent.mozWebRTC||"Chrome"===agent.browser&&agent.version>30||"Opera"===agent.browser&&agent.version>19,agent.isRTPDCSupported="Chrome"===agent.browser&&agent.version<30&&agent.version>24,agent.isPluginSupported=!agent.isSCTPDCSupported&&!agent.isRTPDCSupported,agent},checkMediaDataChannelSettings=function(isOffer,peerBrowserAgent,callback,constraints){if("function"==typeof callback){var peerBrowserVersion,beOfferer=!1;peerBrowserAgent.indexOf("|")>-1&&(peerBrowser=peerBrowserAgent.split("|"),peerBrowserAgent=peerBrowser[0],peerBrowserVersion=parseInt(peerBrowser[1],10));var isLocalFirefox=navigator.mozWebRTC,isLocalFirefoxInterop=navigator.mozWebRTC&&navigator.version>30,isPeerFirefox="Firefox"===peerBrowserAgent,isPeerFirefoxInterop="Firefox"===peerBrowserAgent&&(peerBrowserVersion?peerBrowserVersion>30:!1);if(isOffer){if(isLocalFirefox&&isPeerFirefox||isLocalFirefoxInterop)try{delete constraints.mandatory.MozDontOfferDataChannel}catch(error){}else isLocalFirefox&&!isPeerFirefox&&(constraints.mandatory.MozDontOfferDataChannel=!0);if(!isLocalFirefox)for(var prop in constraints.mandatory)constraints.mandatory.hasOwnProperty(prop)&&-1!==prop.indexOf("Moz")&&delete constraints.mandatory[prop];callback(constraints)}else isLocalFirefox||!isPeerFirefox||isPeerFirefoxInterop||(beOfferer=!0),callback(beOfferer)}},checkIceConnectionState=function(peerID,iceConnectionState,callback,returnStateAlways){if("function"==typeof callback){peerID=peerID?peerID:"peer";var returnState=!1;Temasys.ICEConnectionFiredStates[peerID]&&iceConnectionState!==Temasys._ICECONNECTION_STATE.DISCONNECTED&&iceConnectionState!==Temasys._ICECONNECTION_STATE.FAILED&&iceConnectionState!==Temasys._ICECONNECTION_STATE.CLOSED||(Temasys.ICEConnectionFiredStates[peerID]=[]),iceConnectionState=Temasys._ICECONNECTION_STATE[iceConnectionState],-1===Temasys.ICEConnectionFiredStates[peerID].indexOf(iceConnectionState)&&(Temasys.ICEConnectionFiredStates[peerID].push(iceConnectionState),iceConnectionState===Temasys._ICECONNECTION_STATE.CONNECTED&&setTimeout(function(){Temasys.ICEConnectionFiredStates[peerID].push(Temasys._ICECONNECTION_STATE.DONE),callback(Temasys._ICECONNECTION_STATE.DONE)},1e3),returnState=!0),(returnStateAlways||returnState)&&callback(iceConnectionState)}},checkMediaDataChannel=function(stream,constraints){var testedOptions={audio:!1,video:!1,data:!1};constraints.audio&&stream.getAudioTracks().length>0&&(testedOptions.audio=!0),constraints.video&&stream.getVideoTracks().length>0&&(testedOptions.video=!0);var testPeer=new RTCPeerConnection;try{var dc=testPeer.createDataChannel("_");dc&&(testedOptions.data=!0)}catch(error){}return testedOptions},RTCPeerConnection=null,RTCSessionDescription="object"==typeof RTCSessionDescription?RTCSessionDescription:null,RTCIceCandidate="object"==typeof RTCIceCandidate?RTCSessionDescription:null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,createIceServer=null,createIceServers=null,createIceServers=null,webrtcDetectedBrowser=getDetectedBrowser(),webrtcDetectedBrowser.mozWebRTC)RTCPeerConnection=function(pcConfig,pcConstraints){return maybeFixConfiguration(pcConfig),new mozRTCPeerConnection(pcConfig,pcConstraints)},RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");if(0===url_parts[0].indexOf("stun"))iceServer={url:url};else if(0===url_parts[0].indexOf("turn"))if(webrtcDetectedBrowser.version<27){var turn_url_parts=url.split("?");(1===turn_url_parts.length||0===turn_url_parts[1].indexOf("transport=udp"))&&(iceServer={url:turn_url_parts[0],credential:password,username:username})}else iceServer={url:url,credential:password,username:username};return iceServer},createIceServers=function(urls,username,password){var iceServers=[];for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers},attachMediaStream=function(element,stream){return element.mozSrcObject=stream,element.play(),element},reattachMediaStream=function(to,from){return to.mozSrcObject=from.mozSrcObject,to.play(),to},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]}),__TemWebRTCReady0();else if(webrtcDetectedBrowser.webkitWebRTC)createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?iceServer={url:url}:0===url_parts[0].indexOf("turn")&&(iceServer={url:url,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){var iceServers=[];if(webrtcDetectedBrowser.version>=34)iceServers={urls:urls,credential:password,username:username};else for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers},RTCPeerConnection=function(pcConfig,pcConstraints){return webrtcDetectedBrowser.version<34&&maybeFixConfiguration(pcConfig),new webkitRTCPeerConnection(pcConfig,pcConstraints)},getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(element,stream){return"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src&&(element.src=URL.createObjectURL(stream)),element},reattachMediaStream=function(to,from){return to.src=from.src,to},__TemWebRTCReady0();else if(webrtcDetectedBrowser.pluginWebRTC){var isFirefox="Firefox"===webrtcDetectedBrowser.browser,isSafari="Safari"===webrtcDetectedBrowser.browser,isChrome="Chrome"===webrtcDetectedBrowser.browser,isIE="IE"===webrtcDetectedBrowser.browser;Temasys.WebRTCPlugin.injectPlugin=function(){Temasys.WebRTCPlugin.TemRTCPlugin=document.createElement("object"),Temasys.WebRTCPlugin.TemRTCPlugin.id=Temasys.WebRTCPlugin.temPluginInfo.pluginId,isIE&&(Temasys.WebRTCPlugin.TemRTCPlugin.width="1px",Temasys.WebRTCPlugin.TemRTCPlugin.height="1px"),Temasys.WebRTCPlugin.TemRTCPlugin.width="1px",Temasys.WebRTCPlugin.TemRTCPlugin.height="1px",Temasys.WebRTCPlugin.TemRTCPlugin.type=Temasys.WebRTCPlugin.temPluginInfo.type,Temasys.WebRTCPlugin.TemRTCPlugin.innerHTML='<param name="onload" value="'+Temasys.WebRTCPlugin.temPluginInfo.onload+'"><param name="pluginId" value="'+Temasys.WebRTCPlugin.temPluginInfo.pluginId+'"><param name="windowless" value="false" /> <param name="pageId" value="'+Temasys.WebRTCPlugin.TemPageId+'">',document.body.appendChild(Temasys.WebRTCPlugin.TemRTCPlugin)},Temasys.WebRTCPlugin.injectPlugin(),Temasys.WebRTCPlugin.TemRTCPlugin.onreadystatechange=function(state){},Temasys.WebRTCPlugin.isPluginInstalled=function(comName,plugName,installedCb,notInstalledCb){if(isChrome||isSafari||isFirefox){for(var pluginArray=navigator.plugins,i=0;i<pluginArray.length;i++)if(pluginArray[i].name.indexOf(plugName)>=0)return void installedCb();notInstalledCb()}else{if(!isIE)return;try{{new ActiveXObject(comName+"."+plugName)}}catch(e){return void notInstalledCb()}installedCb()}},Temasys.WebRTCPlugin.defineWebRTCInterface=function(){Temasys.WebRTCPlugin.isDefined=function(variable){return null!==variable&&void 0!==variable},Temasys.WebRTCPlugin.checkIfReady=function(callback){var checkPluginReadyState=setInterval(function(){Temasys.pluginReadyState===Temasys.PLUGIN_READY_STATE.READY&&(clearInterval(checkPluginReadyState),callback())},100)},createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?iceServer={url:url,hasCredentials:!1}:0===url_parts[0].indexOf("turn")&&(iceServer={url:url,hasCredentials:!0,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){for(var iceServers=[],i=0;i<urls.length;++i)iceServers.push(createIceServer(urls[i],username,password));return iceServers},RTCSessionDescription=function(info){Temasys.WebRTCPlugin.checkIfReady(function(){return Temasys.WebRTCPlugin.TemRTCPlugin.ConstructSessionDescription(info.type,info.sdp)})},RTCPeerConnection=function(servers,constraints){Temasys.WebRTCPlugin.checkIfReady(function(){var iceServers=null;if(servers){iceServers=servers.iceServers;for(var i=0;i<iceServers.length;i++)iceServers[i].urls&&!iceServers[i].url&&(iceServers[i].url=iceServers[i].urls),iceServers[i].hasCredentials=Temasys.WebRTCPlugin.isDefined(iceServers[i].username)&&Temasys.WebRTCPlugin.isDefined(iceServers[i].credential)}var mandatory=constraints&&constraints.mandatory?constraints.mandatory:null,optional=constraints&&constraints.optional?constraints.optional:null;return Temasys.WebRTCPlugin.TemRTCPlugin.PeerConnection(Temasys.WebRTCPlugin.TemPageId,iceServers,mandatory,optional)})},MediaStreamTrack={},MediaStreamTrack.getSources=function(callback){Temasys.WebRTCPlugin.checkIfReady(function(){Temasys.WebRTCPlugin.TemRTCPlugin.GetSources(callback)})},getUserMedia=function(constraints,successCallback,failureCallback){Temasys.WebRTCPlugin.checkIfReady(function(){constraints.audio||(constraints.audio=!1),Temasys.WebRTCPlugin.TemRTCPlugin.getUserMedia(constraints,successCallback,failureCallback)})},navigator.getUserMedia=getUserMedia,attachMediaStream=function(element,stream){if(stream.enableSoundTracks(!0),"audio"!==element.nodeName.toLowerCase()){var elementId=0===element.id.length?Math.random().toString(36).slice(2):element.id;if(element.isTemWebRTCPlugin&&element.isTemWebRTCPlugin()){for(var children=element.children,i=0;i!==children.length;++i)if("streamId"===children[i].name){children[i].value=stream.id;break}element.setStreamId(stream.id)}else{var frag=document.createDocumentFragment(),temp=document.createElement("div"),classHTML=element.className?'class="'+element.className+'" ':"";for(temp.innerHTML='<object id="'+elementId+'" '+classHTML+'type="application/x-temwebrtcplugin"><param name="pluginId" value="'+elementId+'" /> <param name="pageId" value="'+Temasys.WebRTCPlugin.TemPageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+stream.id+'" /> </object>';temp.firstChild;)frag.appendChild(temp.firstChild);var rectObject=element.getBoundingClientRect();element.parentNode.insertBefore(frag,element),frag=document.getElementById(elementId),frag.width=rectObject.width+"px",frag.height=rectObject.height+"px",element.parentNode.removeChild(element)}var newElement=document.getElementById(elementId);return newElement.onclick=element.onclick?element.onclick:function(){},newElement._TemOnClick=function(id){var arg={srcElement:document.getElementById(id)};newElement.onclick(arg)},newElement}return element},reattachMediaStream=function(to,from){for(var stream=null,children=from.children,i=0;i!==children.length;++i)if("streamId"===children[i].name){stream=Temasys.WebRTCPlugin.TemRTCPlugin.getStreamWithId(Temasys.WebRTCPlugin.TemPageId,children[i].value);break}return null!==stream?attachMediaStream(to,stream):void 0},RTCIceCandidate=function(candidate){Temasys.WebRTCPlugin.checkIfReady(function(){return candidate.sdpMid||(candidate.sdpMid=""),Temasys.WebRTCPlugin.TemRTCPlugin.ConstructIceCandidate(candidate.sdpMid,candidate.sdpMLineIndex,candidate.candidate)})}},Temasys.WebRTCPlugin.getWebsiteLink=function(){return"http://temasys.atlassian.net/wiki/display/TWPP/WebRTC+Plugins"},Temasys.WebRTCPlugin.getDownloadLink=function(){return navigator.platform.match(/^Mac/i)?"http://bit.ly/1n77hco":navigator.platform.match(/^Win/i)?"http://bit.ly/1kkS4FN":null},Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb=function(){var downloadLink=Temasys.WebRTCPlugin.getDownloadLink();downloadLink?Temasys.WebRTCPlugin.renderNotificationBar('This website needs to install the <a href="'+Temasys.WebRTCPlugin.getWebsiteLink()+'" target="_blank">Temasys WebRTC Plugin</a> to upgrade your browser.',"Install Now",downloadLink):Temasys.WebRTCPlugin.renderNotificationBar("Your browser does not support WebRTC.")},Temasys.WebRTCPlugin.pluginNeedsUpgrade=function(downloadLink){Temasys.WebRTCPlugin.renderNotificationBar('There is a new version of the <a href="'+Temasys.WebRTCPlugin.getWebsiteLink()+'" target="_blank">Temasys WebRTC Plugin</a> available.',"Update Now",downloadLink||Temasys.WebRTCPlugin.getDownloadLink())},Temasys.WebRTCPlugin.renderNotificationBar=function(text,buttonText,buttonLink){var w=window,i=document.createElement("iframe");i.style.position="fixed",i.style.top="-41px",i.style.left=0,i.style.right=0,i.style.width="100%",i.style.height="40px",i.style.backgroundColor="#ffffe1",i.style.border="none",i.style.borderBottom="1px solid #888888",i.style.zIndex="9999999","string"==typeof i.style.webkitTransition?i.style.webkitTransition="all .5s ease-out":"string"==typeof i.style.transition&&(i.style.transition="all .5s ease-out"),document.body.appendChild(i),c=i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument,c.document.open(),c.document.write('<span style="font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 7px; vertical-align: middle; cursor: default;">'+text+"</span>"),buttonText&&buttonLink?(c.document.write('<button id="okay">'+buttonText+"</button><button>Cancel</button>"),c.document.close(),c.document.getElementById("okay").addEventListener("click",function(e){window.open(buttonLink,"_top"),e.preventDefault();try{event.cancelBubble=!0}catch(error){}})):c.document.close(),c.document.addEventListener("click",function(){w.document.body.removeChild(i)}),setTimeout(function(){"string"==typeof i.style.webkitTransform?i.style.webkitTransform="translateY(40px)":"string"==typeof i.style.transform?i.style.transform="translateY(40px)":i.style.top="0px"},300)},Temasys.WebRTCPlugin.isPluginInstalled("Tem","TemWebRTCPlugin",Temasys.WebRTCPlugin.defineWebRTCInterface,Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb)}